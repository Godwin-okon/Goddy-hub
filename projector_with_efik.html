<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <!-- Mammoth.js for DOCX reading -->
<script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>
  <title>AllStreamHub</title>
  <style>
    :root {
      --bg: #0d1117;
      --text: #f0f6fc;
      --accent: #58a6ff;
      --card: #161b22;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: var(--bg);
      color: var(--text);
      overflow-x: hidden;
    }

    .top-bar {
      background-color: var(--card);
      padding: 10px 20px;
      display: flex;
      justify-content: flex-end;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    .menu-btn {
      font-size: 24px;
      background: none;
      border: none;
      color: var(--text);
      cursor: pointer;
    }

    .dropdown {
      position: absolute;
      top: 50px;
      right: 20px;
      background-color: var(--card);
      border: 1px solid #30363d;
      border-radius: 8px;
      display: none;
      flex-direction: column;
      min-width: 160px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.5);
      z-index: 999;
      padding: 8px 0;
    }

    .dropdown a {
      color: white;
      padding: 12px 20px;
      text-decoration: none;
      width: 100%;
      display: block;
      text-align: left;
      font-size: 16px;
    }

    .dropdown a:hover {
      background-color: #444;
    }

    .section {
      padding: 60px 20px;
      max-width: 1000px;
      margin: auto;
      text-align: center;
      animation: fadeInUp 1s ease forwards;
      opacity: 0;
    }

    .section h2 {
      font-size: 2.5rem;
      color: var(--accent);
      margin-bottom: 0.5rem;
    }

    .section p {
      font-size: 1.1rem;
      color: #ccc;
    }

    .login-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: var(--card);
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.5);
      display: none;
      z-index: 1000;
      width: 320px;
      animation: popupFade 0.3s ease-in-out;
    }

    .login-popup h2 {
      margin-top: 0;
      margin-bottom: 20px;
    }

    .login-popup input {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border-radius: 5px;
      border: 1px solid #333;
      background-color: #0d1117;
      color: white;
    }

    .login-popup button {
      width: 100%;
      padding: 10px;
      background-color: var(--accent);
      border: none;
      color: white;
      font-weight: bold;
      border-radius: 5px;
      cursor: pointer;
    }

    .login-popup button:hover {
      background-color: #1f6feb;
    }

    .close-btn {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 18px;
      cursor: pointer;
      color: #999;
    }

    .close-btn:hover {
      color: white;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(40px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes popupFade {
      from { opacity: 0; transform: translate(-50%, -40%); }
      to { opacity: 1; transform: translate(-50%, -50%); }
    }

    footer {
      padding: 20px;
      text-align: center;
      background: #111;
      color: #777;
      font-size: 14px;
    }

    #dashboard {
      display: none;
    }
  
  .popup-msg {
  display: none;
  position: fixed;
  top: 30px;
  right: 30px;
  padding: 15px 20px;
  border-radius: 8px;
  font-weight: bold;
  z-index: 2000;
  animation: fadeInOut 4s ease forwards;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
}

.popup-msg.success {
  background: #28a745;
  color: white;
}

.popup-msg.error {
  background: #dc3545;
  color: white;
}

@keyframes fadeInOut {
  0% { opacity: 0; transform: translateY(-20px); }
  10% { opacity: 1; transform: translateY(0); }
  90% { opacity: 1; transform: translateY(0); }
  100% { opacity: 0; transform: translateY(-20px); }
}
 
  h2, h4 {
    color: var(--accent);
  }

  /* ========== Tab Menu ========== */
  .tab-buttons {
    display: flex;
    justify-content: center;
    background: var(--card);
    border-bottom: 1px solid var(--border);
    margin-bottom: 20px;
    padding: 10px 0;
    border-radius: 10px;
  }

  .tab-button {
    padding: 12px 24px;
    margin: 0 5px;
    background: none;
    color: var(--text);
    font-weight: bold;
    border: none;
    cursor: pointer;
    transition: all 0.3s;
    border-radius: 8px;
  }

  .tab-button:hover {
    background-color: #21262d;
  }

  .tab-button.active {
    background-color: var(--accent);
    color: #fff;
  }

  .tab-content {
    display: none;
    padding: 20px;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 10px;
    margin-bottom: 20px;
    animation: fadeIn 0.5s ease;
  }

  .tab-content.active {
    display: block;
  }

  .controls {
    margin: 15px 0;
  }

  button {
    background: var(--accent);
    color: white;
    border: none;
    padding: 10px 15px;
    margin: 5px 10px 5px 0;
    border-radius: 5px;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s;
  }

  button:hover {
    background: #1f6feb;
  }

  input[type="file"], textarea, select, input[type="color"] {
    margin: 10px 0;
    padding: 10px;
    border-radius: 5px;
    border: 1px solid var(--border);
    background: var(--bg);
    color: var(--text);
    width: 100%;
    box-sizing: border-box;
  }

  .slide {
    padding: 10px;
    margin: 5px 0;
    border: 1px solid var(--border);
    border-radius: 5px;
    background: var(--bg);
    cursor: pointer;
    transition: background 0.3s;
  }

  .slide:hover {
    background: #21262d;
  }

  .live-output {
    background: black;
    color: white;
    padding: 30px;
    font-size: 2.5rem;
    border-radius: 10px;
    min-height: 200px;
    margin-top: 20px;
    border: 2px solid var(--accent);
    text-align: center;
    position: relative;
  }

  .live-header {
    font-size: 1.5rem;
    font-weight: bold;
    margin-bottom: 10px;
    color: white;
  }

  .live-body {
    font-size: 2rem;
    line-height: 1.5;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(15px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  </style>
</head>
<body>
  <!-- Top Bar -->
  <div class="top-bar">
    <button class="menu-btn" onclick="toggleDropdown()">‚ò∞</button>
    <div class="dropdown" id="homeMenu">
      <a href="#" onclick="openLogin()">Sign In</a>
      <a href="#">About</a>
      <a href="#">Help</a>
    </div>
    <div class="dropdown" id="dashboardMenu">
      <a href="#" onclick="logout()">Logout</a>
    </div>
  </div>

  <!-- Login Popup -->
  <div class="login-popup" id="loginPopup">
    <span class="close-btn" onclick="closeLogin()">&times;</span>
    <h2>Sign In</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button onclick="login()">Login</button>
  </div>

  <!-- Messages -->
  <div id="loginSuccessMsg" class="popup-msg success">‚úÖ Login Successful!</div>
  <div id="loginErrorMsg" class="popup-msg error">‚ùå Invalid email or password.</div>
  <div id="logoutMsg" class="popup-msg success">üëã You have been logged out.</div>

  <!-- Homepage -->
  <div id="homePage">
    <div class="section"><h2>Welcome to AllStreamHub</h2><p>Your ultimate worship companion...</p></div>
    <div class="section"><h2>Project Bible & Lyrics</h2><p>Display Bible verses and worship lyrics...</p></div>
    <div class="section"><h2>Powerful Schedule Tools</h2><p>Prepare your sessions in advance...</p></div>
    <div class="section"><h2>Works on Any Screen</h2><p>Supports extended display projection...</p></div>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" style="display: none;">

   <h1 style="text-align: center; color: var(--accent);">üéõÔ∏è AllStreamHub: Bible & Lyrics Projector</h1>

  <!-- ‚úÖ Tab Buttons -->
  <div class="tab-buttons">
    <button class="tab-button active" onclick="showTab('bibleTab', this)">üìñ Bible</button>
    <button class="tab-button" onclick="showTab('lyricsTab', this)">üéµ Lyrics</button>
  
        <!-- Projector Window Launcher -->
<button onclick="window.open('projector.html', 'projector', 'width=800,height=600')">üñ• Open Projector</button>
  </div>

<div id="bibleTab" class="tab-content">
    <h2>üìñ Efik Bible (EFIK)</h2>
    <input type="file" id="efikBibleFile" accept=".xml"><br><br>

    <label>Book: <select id="bookDropdown"></select></label>
    <label>Chapter: <select id="chapterDropdown"></select></label>
    <label>Verse: <select id="verseDropdown"></select></label>

    <div class="controls">
      <button onclick="previousVerse()">‚¨Ö Previous</button>
      <button onclick="nextVerse()">Next ‚û°</button>
      <button onclick="goLiveSelected()">üöÄ Go Live</button>
      <button onclick="clearLive()">üßπ Clear Live</button>
    </div>  
  
    <div id="efikBibleDisplay">Upload an Efik Bible XML file to begin.</div>

    <h4>All Verses in Chapter:</h4>
    <div id="chapterVerses"></div>
  </div>

  <!-- Lyrics Tab -->
  <div id="lyricsTab" class="tab-content">
    <h2>üéµ Lyrics Projection</h2>
    <textarea id="lyricsInput" rows="8" cols="50" placeholder="Type lyrics here..."></textarea><br>
    <input type="file" id="lyricsFile" accept=".txt,.docx">

    <div class="controls">
      <button onclick="goLiveSelectedLyrics()">üöÄ Go Live</button>
      <button onclick="clearLive()">üßπ Clear Live</button>
    </div>
      <div id="lyricsSlides"></div>
  </div>


  <!-- Shared Live Output -->
  <div>
    <label>üé® Background: <input type="color" id="liveBgColor" value="#000000" onchange="changeLiveBg(this.value)"></label>
    <h4>üì° Live Output:</h4>
    <div id="liveOutput" class="live-output">(Go Live content will appear here)</div>
  </div>
<script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>
  
  <footer>&copy; 2025 AllStreamHub. Designed for worship, by Godwin Okon.</footer>

  <script>
        function showTab(tabId, buttonEl) {
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.tab-button').forEach(el => el.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      if (buttonEl) buttonEl.classList.add('active');
    }
    showTab('bibleTab');

    // Bible XML logic
    let efikXML = null;
    document.getElementById('efikBibleFile').addEventListener('change', function () {
      const reader = new FileReader();
      reader.onload = function (e) {
        const parser = new DOMParser();
        efikXML = parser.parseFromString(e.target.result, "text/xml");
        loadBooks();
      };
      reader.readAsText(this.files[0]);
    });

    function loadBooks() {
      const books = Array.from(efikXML.getElementsByTagName("BIBLEBOOK"));
      const bookDropdown = document.getElementById("bookDropdown");
      bookDropdown.innerHTML = books.map(b => `<option>${b.getAttribute("bname")}</option>`).join("");
      bookDropdown.onchange = loadChapters;
      loadChapters();
    }

    function loadChapters() {
      const book = getSelectedBook();
      const chapters = Array.from(book.getElementsByTagName("CHAPTER"));
      const chapterDropdown = document.getElementById("chapterDropdown");
      chapterDropdown.innerHTML = chapters.map(c => `<option>${c.getAttribute("cnumber")}</option>`).join("");
      chapterDropdown.onchange = loadVerses;
      loadVerses();
    }

    function loadVerses() {
      const chapter = getSelectedChapter();
      const verses = Array.from(chapter.getElementsByTagName("VERS"));
      const verseDropdown = document.getElementById("verseDropdown");
      verseDropdown.innerHTML = verses.map(v => `<option>${v.getAttribute("vnumber")}</option>`).join("");
      verseDropdown.onchange = displayVerse;
      displayVerse();

      const container = document.getElementById("chapterVerses");
      container.innerHTML = verses.map(v =>
        `<div class="slide" onclick="goLive('${getBookName()}', '${getChapterNumber()}', '${v.getAttribute("vnumber")}')">
          ${getBookName()} ${getChapterNumber()}:${v.getAttribute("vnumber")} - ${v.textContent}
        </div>`).join("");
    }

    function getBookName() {
      return document.getElementById("bookDropdown").value;
    }

    function getChapterNumber() {
      return document.getElementById("chapterDropdown").value;
    }

    function getVerseNumber() {
      return document.getElementById("verseDropdown").value;
    }

    function getSelectedBook() {
      return Array.from(efikXML.getElementsByTagName("BIBLEBOOK")).find(b => b.getAttribute("bname") === getBookName());
    }

    function getSelectedChapter() {
      return Array.from(getSelectedBook().getElementsByTagName("CHAPTER")).find(c => c.getAttribute("cnumber") === getChapterNumber());
    }

    function displayVerse() {
      const verse = Array.from(getSelectedChapter().getElementsByTagName("VERS")).find(v => v.getAttribute("vnumber") === getVerseNumber());
      document.getElementById("efikBibleDisplay").textContent =
        `${getBookName()} ${getChapterNumber()}:${getVerseNumber()} (EFIK)\n\n${verse ? verse.textContent : "Verse not found."}`;
    }

    function goLive(book, chapter, verse) {
      document.getElementById("bookDropdown").value = book;
      loadChapters();
      setTimeout(() => {
        document.getElementById("chapterDropdown").value = chapter;
        loadVerses();
        setTimeout(() => {
          document.getElementById("verseDropdown").value = verse;
          displayVerse();
          goLiveSelected();
        }, 100);
      }, 100);
    }

    function goLiveSelected() {
      const book = getBookName();
      const chapter = getChapterNumber();
      const verse = getVerseNumber();
      const verseText = Array.from(getSelectedChapter().getElementsByTagName("VERS"))
        .find(v => v.getAttribute("vnumber") === verse)?.textContent || "Verse not found.";

      document.getElementById("liveOutput").innerHTML = `
        <div class="live-header">${book} ${chapter}:${verse} (EFIK)</div>
        <div class="live-body">${verseText}</div>`;
    }

    function nextVerse() {
      const dropdown = document.getElementById("verseDropdown");
      dropdown.selectedIndex = Math.min(dropdown.options.length - 1, dropdown.selectedIndex + 1);
      displayVerse();
      goLiveSelected();
    }

    function previousVerse() {
      const dropdown = document.getElementById("verseDropdown");
      dropdown.selectedIndex = Math.max(0, dropdown.selectedIndex - 1);
      displayVerse();
      goLiveSelected();
    }

    function clearLive() {
      document.getElementById("liveOutput").textContent = "";
    }

    function changeLiveBg(color) {
      document.getElementById("liveOutput").style.backgroundColor = color;
    }
      // Lyrics logic
    document.getElementById("lyricsInput").addEventListener("input", updateLyricsSlides);
    document.getElementById("lyricsFile").addEventListener("change", handleLyricsFile);

    function handleLyricsFile(e) {
      const file = e.target.files[0];
      if (!file) return;

      if (file.name.endsWith(".txt")) {
        const reader = new FileReader();
        reader.onload = function (evt) {
          const text = evt.target.result;
          document.getElementById("lyricsInput").value = text;
          updateLyricsSlides();
        };
        reader.readAsText(file);
      } else if (file.name.endsWith(".docx")) {
        const reader = new FileReader();
        reader.onload = function (evt) {
          mammoth.extractRawText({ arrayBuffer: evt.target.result })
            .then(result => {
              document.getElementById("lyricsInput").value = result.value;
              updateLyricsSlides();
            })
            .catch(err => {
              alert("Error reading .docx: " + err.message);
            });
        };
        reader.readAsArrayBuffer(file);
      } else {
        alert("Unsupported file type.");
      }
    }

    function updateLyricsSlides() {
      const lines = document.getElementById("lyricsInput").value.split(/\r?\n/).filter(l => l.trim() !== "");
      const container = document.getElementById("lyricsSlides");
      container.innerHTML = lines.map(line =>
        `<div class="slide" onclick="goLiveLyrics('${line.replace(/'/g, "\\'")}')">${line}</div>`).join("");
    }

    function goLiveLyrics(text) {
      document.getElementById("liveOutput").textContent = text;
    }

    function goLiveSelectedLyrics() {
      const firstLine = document.querySelector("#lyricsSlides .slide");
      if (firstLine) goLiveLyrics(firstLine.textContent);
    }

    // Keyboard controls
    window.addEventListener("keydown", e => {
      if (e.key === "ArrowRight") nextVerse();
      else if (e.key === "ArrowLeft") previousVerse();
      else if (e.ctrlKey && e.key.toLowerCase() === "l") goLiveSelected();
      else if (e.ctrlKey && e.key.toLowerCase() === "c") clearLive();
    });
    
    function toggleDropdown() {
      const isLoggedIn = localStorage.getItem("loggedIn") === "true";
      const menu = isLoggedIn ? document.getElementById("dashboardMenu") : document.getElementById("homeMenu");
      const other = isLoggedIn ? document.getElementById("homeMenu") : document.getElementById("dashboardMenu");
      other.style.display = "none";
      menu.style.display = menu.style.display === "flex" ? "none" : "flex";
    }

    function openLogin() {
      document.getElementById("loginPopup").style.display = "block";
      document.getElementById("homeMenu").style.display = "none";
    }

    function closeLogin() {
      document.getElementById("loginPopup").style.display = "none";
    }

    function login() {
      const email = document.getElementById("email").value.trim();
      const pass = document.getElementById("password").value.trim();
      const successMsg = document.getElementById("loginSuccessMsg");
      const errorMsg = document.getElementById("loginErrorMsg");

      if (email === "okongodwin270@gmail.com" && pass === "Stacol123boy") {
        localStorage.setItem("loggedIn", "true");
        document.getElementById("dashboard").style.display = "block";
        document.getElementById("homePage").style.display = "none";
        document.getElementById("loginPopup").style.display = "none";

        document.getElementById("homeMenu").style.display = "none";
        document.getElementById("dashboardMenu").style.display = "none";

        successMsg.style.display = "block";
        setTimeout(() => successMsg.style.display = "none", 3000);

        document.getElementById("email").value = "";
        document.getElementById("password").value = "";
      } else {
        errorMsg.style.display = "block";
        setTimeout(() => errorMsg.style.display = "none", 3000);
      }
    }

    function logout() {
      localStorage.removeItem("loggedIn");
      document.getElementById("dashboard").style.display = "none";
      document.getElementById("homePage").style.display = "block";
      document.getElementById("loginPopup").style.display = "none";
      document.getElementById("email").value = "";
      document.getElementById("password").value = "";

      document.getElementById("dashboardMenu").style.display = "none";
      document.getElementById("homeMenu").style.display = "none";

      const logoutMsg = document.getElementById("logoutMsg");
      logoutMsg.style.display = "block";
      setTimeout(() => {
        logoutMsg.style.display = "none";
        openLogin();
      }, 3000);
    }

    window.onload = function () {
      const loggedIn = localStorage.getItem("loggedIn") === "true";
      document.getElementById("dashboard").style.display = loggedIn ? "block" : "none";
      document.getElementById("homePage").style.display = loggedIn ? "none" : "block";

      document.getElementById("dashboardMenu").style.display = "none";
      document.getElementById("homeMenu").style.display = "none";
    };

    // Animate sections
    const sections = document.querySelectorAll('.section');
    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.style.opacity = '1';
          entry.target.style.transform = 'translateY(0)';
        }
      });
    }, { threshold: 0.1 });
    sections.forEach(section => observer.observe(section));
    
  // Open projector window
  let projectorWindow;

function openProjector() {
  if (!projectorWindow || projectorWindow.closed) {
    projectorWindow = window.open("projector.html", "ProjectorWindow", "width=800,height=600");
  } else {
    projectorWindow.focus();
  }
}
  // Send content to projector
  function sendToProjector(content) {
  if (projectorWindow && !projectorWindow.closed) {
    projectorWindow.postMessage(content, "*");
  } else {
    alert("Projector is not open.");
  }
}

  // Call this when you go "Live"
  function goLiveFromLyrics(text) {
    const html = `<div style="font-size:3em; color:white;">${text}</div>`;
    document.getElementById("liveOutput").innerHTML = html;
    sendToProjector(html);
  }

  function goLiveFromBible(book, chapter, verse, version, text) {
    const html = `
      <div style="font-size:2em; font-weight:bold; margin-bottom:0.5em;">${book} ${chapter}:${verse} (${version})</div>
      <div style="font-size:3em; color:white;">${text}</div>
    `;
    document.getElementById("liveOutput").innerHTML = html;
    sendToProjector(html);
  }
     </script>
</body>
</html>